var script = [{
	"alfred": {
		"title": "",
		"icon": "imgs/piratebay.png",
		"list": [{
				"title": "Audio",
				"sub": "Tab to search for audio only"
			}, {
				"title": "Video",
				"sub": "Tab to search for video only"
			}, {
				"title": "Applications",
				"sub": "Tab to search for applications only"
			}, {
				"title": "Games",
				"sub": "Tab to search for games only"
			}, {
				"title": "Porn",
				"sub": "Tab to search for porn only"
			}, {
				"title": "Other",
				"sub": "Tab to search for other only"
		}]
	},
	"duration": 1000
}, {
	"alfred": {
		"title": "",
		"icon": "imgs/piratebay.png",
		"list": [{
				"title": "Audio",
				"sub": "Tab to search for audio only"
			}, {
				"title": "Video",
				"sub": "Tab to search for video only",
				"selected": true
			}, {
				"title": "Applications",
				"sub": "Tab to search for applications only"
			}, {
				"title": "Games",
				"sub": "Tab to search for games only"
			}, {
				"title": "Porn",
				"sub": "Tab to search for porn only"
			}, {
				"title": "Other",
				"sub": "Tab to search for other only"
		}]
	},
	"duration": 2000
}, {
	"alfred": {
		"title": " Video ➔ ",
		"icon": "imgs/piratebay.png",
		"list": [{
				"title": "Video ➔ Movies",
				"sub": "Tab to search for Video ➔ Movies only"
			}, {
				"title": "Video ➔ Music videos",
				"sub": "Tab to search for Video ➔ Music videos only"
			}, {
				"title": "Video ➔ TV Shows",
				"sub": "Tab to search for Video ➔ TV Shows only"
			}, {
				"title": "Video ➔ HD - Movies",
				"sub": "Tab to search for Video ➔ HD - Movies only"
			}, {
				"title": "Video ➔ HD - TV Shows",
				"sub": "Tab to search for Video ➔ HD - TV Shows only"
			}, {
				"title": "Video ➔ 3D",
				"sub": "Tab to search for Video ➔ 3D only"
			}]
	},
	"duration": 2000,
	"keypress": "⇥"
}, {
	"alfred": {
		"title": " Video ➔ t",
		"icon": "imgs/piratebay.png",
		"list": [{
				"title": "Video ➔ TV Shows",
				"sub": "Tab to search for Video ➔ TV Shows only"
			}, {
				"title": "Video ➔ HD - TV Shows",
				"sub": "Tab to search for Video ➔ HD - TV Shows only"
			}]
	},
	"duration": 1000
}, {
	"alfred": {
		"title": " Video ➔ t",
		"icon": "imgs/piratebay.png",
		"list": [{
				"title": "Video ➔ TV Shows",
				"sub": "Tab to search for Video ➔ TV Shows only"
			}, {
				"title": "Video ➔ HD - TV Shows",
				"sub": "Tab to search for Video ➔ HD - TV Shows only",
				"selected": true
			}]
	},
	"duration": 1000
}, {
	"alfred": {
		"title": " Video ➔ HD - TV shows ➔ ",
		"icon": "imgs/piratebay.png",
		"list": [{
				"title": "...",
				"sub": "Type a query to get the magic going :)"
			}]
	},
	"duration": 1000,
	"keypress": "⇥"
}, {
	"alfred": {
		"title": " Video ➔ HD - TV shows ➔ e",
		"icon": "imgs/piratebay.png",
		"list": [{
				"title": "...",
				"sub": "The query \"e\" is too short ; it requires 3 more characters."
			}]
	},
	"duration": 500,
}, {
	"alfred": {
		"title": " Video ➔ HD - TV shows ➔ ex",
		"icon": "imgs/piratebay.png",
		"list": [{
				"title": "...",
				"sub": "The query \"ex\" is too short ; it requires 2 more characters."
			}]
	},
	"duration": 500,
}, {
	"alfred": {
		"title": " Video ➔ HD - TV shows ➔ ext",
		"icon": "imgs/piratebay.png",
		"list": [{
				"title": "...",
				"sub": "The query \"ext\" is too short ; it requires 1 more character."
			}]
	},
	"duration": 500,
}, {
	"alfred": {
		"title": " Video ➔ HD - TV shows ➔ exta",
		"icon": "imgs/piratebay.png",
		"list": [{
				"title": "No result for \"exta\"",
				"sub": "No hits. Try adding and asterisk in your search phrase."
			}]
	},
	"duration": 500,
}, {
	"alfred": {
		"title": " Video ➔ HD - TV shows ➔ extan",
		"icon": "imgs/piratebay.png",
		"list": [{
				"title": "No result for \"extan\"",
				"sub": "No hits. Try adding and asterisk in your search phrase."
			}]
	},
	"duration": 500,
}, {
	"alfred": {
		"title": " Video ➔ HD - TV shows ➔ extant",
		"icon": "imgs/piratebay.png",
		"list": [{
				"title": "Extant.S01E02.720p.HDTV.X264-DIMENSION[rartv]",
				"sub": "(✓) Video (HD - TV Shows), Size: 729.7 MiB, Seeders: 492, Leechers: 14, for \"extant\""
			}, {
				"title": "Extant.S01E01.720p.HDTV.X264-DIMENSION[rartv]",
				"sub": "(✓) Video (HD - TV Shows), Size: 726.92 MiB, Seeders: 555, Leechers: 17, for \"extant\""
			}, {
				"title": "Extant.S01E03.720p.HDTV.X264-DIMENSION[rartv]",
				"sub": "Video (HD - TV Shows), Size: 987.66 MiB, Seeders: 518, Leechers: 23, for \"extant\""
			}, {
				"title": "Extant.S01E03.1080p.WEB-DL.DD5.1.H.264-EC[rartv]",
				"sub": "Video (HD - TV Shows), Size: 1.6 GiB, Seeders: 110, Leechers: 19, for \"extant\""
			}, {
				"title": "Extant.S01E01.720p.HDTV.X264-DIMENSION[rartv]",
				"sub": "Video (HD - TV Shows), Size: 1.54 GiB, Seeders: 102, Leechers: 6, for \"extant\""
			}]
	},
	"duration": 1500,
}, {
	"alfred": {
		"title": " Video ➔ HD - TV shows ➔ extant",
		"icon": "imgs/piratebay.png",
		"list": [{
				"title": "Extant.S01E02.720p.HDTV.X264-DIMENSION[rartv]",
				"sub": "(✓) Video (HD - TV Shows), Size: 729.7 MiB, Seeders: 492, Leechers: 14, for \"extant\""
			}, {
				"title": "Extant.S01E01.720p.HDTV.X264-DIMENSION[rartv]",
				"sub": "(✓) Video (HD - TV Shows), Size: 726.92 MiB, Seeders: 555, Leechers: 17, for \"extant\"",
				"selected": true
			}, {
				"title": "Extant.S01E03.720p.HDTV.X264-DIMENSION[rartv]",
				"sub": "Video (HD - TV Shows), Size: 987.66 MiB, Seeders: 518, Leechers: 23, for \"extant\""
			}, {
				"title": "Extant.S01E03.1080p.WEB-DL.DD5.1.H.264-EC[rartv]",
				"sub": "Video (HD - TV Shows), Size: 1.6 GiB, Seeders: 110, Leechers: 19, for \"extant\""
			}, {
				"title": "Extant.S01E01.720p.HDTV.X264-DIMENSION[rartv]",
				"sub": "Video (HD - TV Shows), Size: 1.54 GiB, Seeders: 102, Leechers: 6, for \"extant\""
			}]
	},
	"duration": 300,
}, {
	"alfred": {
		"title": " Video ➔ HD - TV shows ➔ extant",
		"icon": "imgs/piratebay.png",
		"list": [{
				"title": "Extant.S01E02.720p.HDTV.X264-DIMENSION[rartv]",
				"sub": "(✓) Video (HD - TV Shows), Size: 729.7 MiB, Seeders: 492, Leechers: 14, for \"extant\""
			}, {
				"title": "Extant.S01E01.720p.HDTV.X264-DIMENSION[rartv]",
				"sub": "(✓) Video (HD - TV Shows), Size: 726.92 MiB, Seeders: 555, Leechers: 17, for \"extant\""
			}, {
				"title": "Extant.S01E03.720p.HDTV.X264-DIMENSION[rartv]",
				"sub": "Video (HD - TV Shows), Size: 987.66 MiB, Seeders: 518, Leechers: 23, for \"extant\"",
				"selected": true
			}, {
				"title": "Extant.S01E03.1080p.WEB-DL.DD5.1.H.264-EC[rartv]",
				"sub": "Video (HD - TV Shows), Size: 1.6 GiB, Seeders: 110, Leechers: 19, for \"extant\""
			}, {
				"title": "Extant.S01E01.720p.HDTV.X264-DIMENSION[rartv]",
				"sub": "Video (HD - TV Shows), Size: 1.54 GiB, Seeders: 102, Leechers: 6, for \"extant\""
			}]
	},
	"duration": 1000,
}, {
	"alfred": {
		"title": " Video ➔ HD - TV shows ➔ extant",
		"icon": "imgs/piratebay.png",
		"list": [{
				"title": "Extant.S01E02.720p.HDTV.X264-DIMENSION[rartv]",
				"sub": "(✓) Video (HD - TV Shows), Size: 729.7 MiB, Seeders: 492, Leechers: 14, for \"extant\""
			}, {
				"title": "Extant.S01E01.720p.HDTV.X264-DIMENSION[rartv]",
				"sub": "(✓) Video (HD - TV Shows), Size: 726.92 MiB, Seeders: 555, Leechers: 17, for \"extant\""
			}, {
				"title": "Extant.S01E03.720p.HDTV.X264-DIMENSION[rartv]",
				"sub": "Open torrent page on website",
				"selected": true
			}, {
				"title": "Extant.S01E03.1080p.WEB-DL.DD5.1.H.264-EC[rartv]",
				"sub": "Video (HD - TV Shows), Size: 1.6 GiB, Seeders: 110, Leechers: 19, for \"extant\""
			}, {
				"title": "Extant.S01E01.720p.HDTV.X264-DIMENSION[rartv]",
				"sub": "Video (HD - TV Shows), Size: 1.54 GiB, Seeders: 102, Leechers: 6, for \"extant\""
			}]
	},
	"keypress": "fn",
	"duration": 2000,
}, {
	"alfred": {
		"title": " Video ➔ HD - TV shows ➔ extant",
		"icon": "imgs/piratebay.png",
		"list": [{
				"title": "Extant.S01E02.720p.HDTV.X264-DIMENSION[rartv]",
				"sub": "(✓) Video (HD - TV Shows), Size: 729.7 MiB, Seeders: 492, Leechers: 14, for \"extant\""
			}, {
				"title": "Extant.S01E01.720p.HDTV.X264-DIMENSION[rartv]",
				"sub": "(✓) Video (HD - TV Shows), Size: 726.92 MiB, Seeders: 555, Leechers: 17, for \"extant\""
			}, {
				"title": "Extant.S01E03.720p.HDTV.X264-DIMENSION[rartv]",
				"sub": "Run search on website",
				"selected": true
			}, {
				"title": "Extant.S01E03.1080p.WEB-DL.DD5.1.H.264-EC[rartv]",
				"sub": "Video (HD - TV Shows), Size: 1.6 GiB, Seeders: 110, Leechers: 19, for \"extant\""
			}, {
				"title": "Extant.S01E01.720p.HDTV.X264-DIMENSION[rartv]",
				"sub": "Video (HD - TV Shows), Size: 1.54 GiB, Seeders: 102, Leechers: 6, for \"extant\""
			}]
	},
	"keypress": "⌃",
	"duration": 2000,
}, {
	"alfred": {
		"title": " Video ➔ HD - TV shows ➔ extant",
		"icon": "imgs/piratebay.png",
		"list": [{
				"title": "Extant.S01E02.720p.HDTV.X264-DIMENSION[rartv]",
				"sub": "(✓) Video (HD - TV Shows), Size: 729.7 MiB, Seeders: 492, Leechers: 14, for \"extant\""
			}, {
				"title": "Extant.S01E01.720p.HDTV.X264-DIMENSION[rartv]",
				"sub": "(✓) Video (HD - TV Shows), Size: 726.92 MiB, Seeders: 555, Leechers: 17, for \"extant\""
			}, {
				"title": "Extant.S01E03.720p.HDTV.X264-DIMENSION[rartv]",
				"sub": "Stream with NodeJS' Peerflix",
				"selected": true
			}, {
				"title": "Extant.S01E03.1080p.WEB-DL.DD5.1.H.264-EC[rartv]",
				"sub": "Video (HD - TV Shows), Size: 1.6 GiB, Seeders: 110, Leechers: 19, for \"extant\""
			}, {
				"title": "Extant.S01E01.720p.HDTV.X264-DIMENSION[rartv]",
				"sub": "Video (HD - TV Shows), Size: 1.54 GiB, Seeders: 102, Leechers: 6, for \"extant\""
			}]
	},
	"keypress": "⌥",
	"duration": 2000,
}, {
	"alfred": {
		"title": " Video ➔ HD - TV shows ➔ extant",
		"icon": "imgs/piratebay.png",
		"list": [{
				"title": "Extant.S01E02.720p.HDTV.X264-DIMENSION[rartv]",
				"sub": "(✓) Video (HD - TV Shows), Size: 729.7 MiB, Seeders: 492, Leechers: 14, for \"extant\""
			}, {
				"title": "Extant.S01E01.720p.HDTV.X264-DIMENSION[rartv]",
				"sub": "(✓) Video (HD - TV Shows), Size: 726.92 MiB, Seeders: 555, Leechers: 17, for \"extant\""
			}, {
				"title": "Extant.S01E03.720p.HDTV.X264-DIMENSION[rartv]",
				"sub": "Video (HD - TV Shows), Size: 987.66 MiB, Seeders: 518, Leechers: 23, for \"extant\"",
				"selected": true
			}, {
				"title": "Extant.S01E03.1080p.WEB-DL.DD5.1.H.264-EC[rartv]",
				"sub": "Video (HD - TV Shows), Size: 1.6 GiB, Seeders: 110, Leechers: 19, for \"extant\""
			}, {
				"title": "Extant.S01E01.720p.HDTV.X264-DIMENSION[rartv]",
				"sub": "Video (HD - TV Shows), Size: 1.54 GiB, Seeders: 102, Leechers: 6, for \"extant\""
			}]
	},
	"duration": 1000,
}, {
	"notification": {
		"title": "Extant.S01E03.720p.HDTV.X264-DIMENSION[rartv]",
		"sub": "Download started..."
	},
	"keypress": "↩",
	"duration": 2000
}, {
	"alfred": {
		"title": "",
		"icon": "imgs/transmission.png",
		"list": [{
				"title": "Extant.S01E02.720p.HDTV.X264-DIMENSION[rartv]",
				"sub": "729.7 MiB - Transfer complete",
				"icon": "imgs/finished.png"
			}, {
				"title": "Extant.S01E03.720p.HDTV.X264-DIMENSION[rartv]",
				"sub": "0.21% of 987.66 MiB - DL: 1.87 MiB/s",
				"icon": "imgs/downloading.png"
			}]
	},
	"duration": 500
}, {
	"alfred": {
		"title": "",
		"icon": "imgs/transmission.png",
		"list": [{
				"title": "Extant.S01E02.720p.HDTV.X264-DIMENSION[rartv]",
				"sub": "729.7 MiB - Transfer complete",
				"icon": "imgs/finished.png"
			}, {
				"title": "Extant.S01E03.720p.HDTV.X264-DIMENSION[rartv]",
				"sub": "0.21% of 987.66 MiB - DL: 1.87 MiB/s",
				"icon": "imgs/downloading.png",
				"selected": true
			}]
	},
	"duration": 1500
}, {
	"alfred": {
		"title": "",
		"icon": "imgs/transmission.png",
		"list": [{
				"title": "Extant.S01E02.720p.HDTV.X264-DIMENSION[rartv]",
				"sub": "729.7 MiB - Transfer complete",
				"icon": "imgs/finished.png"
			}, {
				"title": "Extant.S01E03.720p.HDTV.X264-DIMENSION[rartv]",
				"sub": "Remove selected torrent.",
				"icon": "imgs/downloading.png",
				"selected": true
			}]
	},
	"duration": 2000,
	"keypress": "fn"
}, {
	"alfred": {
		"title": "",
		"icon": "imgs/transmission.png",
		"list": [{
				"title": "Extant.S01E02.720p.HDTV.X264-DIMENSION[rartv]",
				"sub": "729.7 MiB - Transfer complete",
				"icon": "imgs/finished.png"
			}, {
				"title": "Extant.S01E03.720p.HDTV.X264-DIMENSION[rartv]",
				"sub": "Remove selected torrent and associated files.",
				"icon": "imgs/downloading.png",
				"selected": true
			}]
	},
	"duration": 2000,
	"keypress": "⌃"
}, {
	"alfred": {
		"title": "",
		"icon": "imgs/transmission.png",
		"list": [{
				"title": "Extant.S01E02.720p.HDTV.X264-DIMENSION[rartv]",
				"sub": "729.7 MiB - Transfer complete",
				"icon": "imgs/finished.png"
			}]
	},
	"duration": 2000,
	"keypress": "↩"
}, {
	"duration": 2000,
	"keypress": "⎋"
}];

function echo_state (state) {
	if(state.alfred){
		alfred.className = "";
		var list = alfred.getElementsByTagName('li');
		var main_icon = (state.alfred.icon?state.alfred.icon:"imgs/alfred.png");
		list[0].firstElementChild.setAttribute('src', main_icon);
		list[0].lastElementChild.innerHTML = state.alfred.title;
		for (var i = list.length - 1; i >= 1; i--) {
			alfred.removeChild(list[i]);
		};
		if(state.alfred.list){
			var selected = false;
			for (var i = 0, l = state.alfred.list.length ; i < l; i++) {
				var li = document.createElement('li');
				var inner = "<img src=\""+(state.alfred.list[i].icon?state.alfred.list[i].icon:main_icon)+"\"><p"+(state.alfred.list[i].sub?"":" class=\"no-sub\"")+">"+state.alfred.list[i].title+(state.alfred.list[i].sub?"<p>"+state.alfred.list[i].sub:"");
				li.innerHTML = inner;
				if(state.alfred.list[i].selected){
					li.className = "selected";
					selected = true;
				}
				alfred.appendChild(li);
			};
			if(!selected){
				list[1].className = "selected";
			}
		}
	} else {
		alfred.className = "off";
	}

	if(state.notification){
		var notification = document.getElementById('notification');
		if(notification) notification.parentNode.removeChild(notification);
		notification = document.createElement('div');
		notification.setAttribute('id', "notification");

		var inner = "<p>"+(state.notification.title?state.notification.title:"Title")+"<p>"+(state.notification.sub?state.notification.sub:"subtitle");
		notification.innerHTML = inner;

		alfred.parentNode.appendChild(notification);
	}

	if(state.keypress){
		var keypress = document.getElementById('keypress');
		if(keypress) keypress.parentNode.removeChild(keypress);
		keypress = document.createElement('div');
		keypress.setAttribute('id', "keypress");
		keypress.innerHTML = state.keypress;
		alfred.parentNode.appendChild(keypress);
	}

}

function play_script(script, from, to, loop, current){
	if(typeof from === "undefined") from = 0;
	if(typeof to === "undefined") to = 0;
	if(typeof loop === "undefined") loop = true;
	if(typeof current === "undefined") current = from;

	echo_state(script[current]);
	if (script[current].callback && typeof(script[current].callback) === "function") {
		script[current].callback(current);
	}

	setTimeout(function () {
		var temp_to = (to==0)?script.length:Math.min(script.length,to);
		if(current>=temp_to-1 && loop)
			play_script(script, from, to, loop, from);
		else if(current<temp_to-1)
			play_script(script, from, to, loop, current+1);
	}, script[current].duration);
}

var alfred = document.getElementById('alfred');
play_script(script);
